"use strict";window.kuvenoApp=angular.module("app",["ngRoute","ngAnimate","ngCookies","ui.bootstrap","pascalprecht.translate","ui.router","facebook","wakanda"]).run(["$rootScope","$state","$stateParams","$wakanda",function($rootScope,$state,$stateParams,$wakanda){var oninit;$rootScope.wakandaInit=!1,$rootScope.$stateHistory=[],$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.onBack=!1,$rootScope.back=function(){$rootScope.onBack=!0,$rootScope.$stateHistory.length>1&&($state.go($rootScope.$stateHistory[$rootScope.$stateHistory.length-2]),$rootScope.$stateHistory.pop())},$wakanda.init().then(oninit=function(ds){$rootScope.initialized="initialized",$rootScope.dataClasses=Object.keys(ds.getDataClasses()),$rootScope.wakandaInit=!0})}]).config(function(FacebookProvider){return FacebookProvider.init("1655840277976205")}).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $urlRouterProvider.otherwise("/main"),$stateProvider.state("auth",{url:"/auth",templateUrl:"views/auth.html"}).state("auth.SignUp",{url:"/sign_up",templateUrl:"views/auth/sign_up.html"}).state("auth.SignIn",{url:"/sign_in",templateUrl:"views/auth/sign_in.html"}).state("auth.SignOut",{url:"/sign_out",controller:function($state,$rootScope,$wakanda){localStorage.removeItem("user_id"),localStorage.removeItem("user_facebook_id"),localStorage.removeItem("user_firstname"),localStorage.removeItem("user_lastname"),localStorage.removeItem("user_link"),localStorage.removeItem("user_locale"),localStorage.removeItem("user_name"),localStorage.removeItem("user_timezone"),localStorage.removeItem("user_updated_time"),localStorage.removeItem("user_verified"),localStorage.removeItem("user_avatar"),localStorage.removeItem("user_country"),localStorage.removeItem("user_email"),localStorage.removeItem("user_title"),$rootScope.user={},$wakanda.$logout(),$state.go("auth.SignIn")}}).state("createMeetingNote",{url:"/create_meeting_note",templateUrl:"views/create_meeting_note.html"}).state("action",{url:"/action",templateUrl:"views/action.html"}).state("action.AgreeOnDate",{url:"/agree_on_date",templateUrl:"views/action/agree_on_date.html"}).state("action.CreateAgenda",{url:"/create_agenda",templateUrl:"views/action/create_agenda.html"}).state("action.ViewMeeting",{url:"/view_meeting/:meetingId",templateUrl:"views/action/view_meeting.html"}).state("action.ListAllMeeting",{url:"/list_all_meeting",templateUrl:"views/action/list_all_meeting.html"}).state("action.CreateEMeeting",{url:"/create_e_meeting",templateUrl:"views/action/create_e_meeting.html"}).state("action.ViewEMeeting",{url:"/view_e_meeting/:eMeetingId",templateUrl:"views/action/view_e_meeting.html"}).state("user",{url:"/user",templateUrl:"views/user.html"}).state("user.Profile",{url:"/profile",templateUrl:"views/user/profile.html"}).state("user.ProfileUpdate",{url:"/profile_update",templateUrl:"views/user/profile_update.html"}).state("user.ChangePassword",{url:"/change_password",templateUrl:"views/user/change_password.html"}).state("user.SendFeedback",{url:"/send_feedback",templateUrl:"views/user/send_feedback.html"}).state("user.Groups",{url:"/groups",templateUrl:"views/user/groups.html"}).state("user.MyTask",{url:"/my_task",templateUrl:"views/user/my_task.html"}).state("user.UpcommingMeeting",{url:"/upcomming_meeting",templateUrl:"views/user/upcomming_meeting.html"}).state("main",{url:"/main",templateUrl:"views/main.html"}).state("main.Home",{url:"/home",templateUrl:"views/main/home.html"})}]).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"/l10n/",suffix:".json"}),null===localStorage.getItem("lang")&&localStorage.setItem("lang","English"),$translateProvider.preferredLanguage(localStorage.getItem("lang"))}]),kuvenoApp.controller("AppCtrl",["$rootScope","$scope","$location",function($rootScope,$scope,$location){return $scope.isSpecificPage=function(){var path;return path=$location.path(),_.contains(["/auth/sign_up","/auth/sign_in"],path)},$rootScope.user=localStorage.getItem("user_id")?{id:localStorage.getItem("user_id"),first_name:localStorage.getItem("user_first_name"),last_name:localStorage.getItem("user_last_name"),link:localStorage.getItem("user_link"),locale:localStorage.getItem("user_locale"),name:localStorage.getItem("user_name"),timezone:localStorage.getItem("user_timezone"),updated_time:localStorage.getItem("user_updated_time"),verified:localStorage.getItem("user_verified"),avatar:localStorage.getItem("user_avatar"),country:localStorage.getItem("user_country")}:{},$scope.main={brand:"Kuveno"}}]).controller("NavCtrl",["$scope",function(){}]),kuvenoApp.controller("SignInCtrl",["$q","$rootScope","$scope","$state","$wakanda","AuthSrv",function($q,$rootScope,$scope,$state,$wakanda,AuthSrv){$q.defer();$scope.facebookLogin=function(){return AuthSrv.facebookLogin()},$scope.linkedinLogin=function(){return window.location.href="https://www.linkedin.com/uas/oauth2/authorization?response_type=code&client_id=7581d2bszc4sid&scope=r_emailaddress%20r_fullprofile%20r_basicprofile&state=KbyUmhTLMpYj7CD2di7JKP1PcqmLlkPt&redirect_uri=http://localhost:9000"},$scope.emailLogin=function(){$wakanda.$login(signinForm.email.value,signinForm.password.value).then(function(data){data.result?($scope.error=!1,$wakanda.$currentUser().then(function(user){localStorage.setItem("user_id",user.result.ID),localStorage.setItem("user_email",user.result.userName),$wakanda.$ds.User.$findOne(user.result.ID).$promise.then(function(data){localStorage.setItem("user_firstname",data.result.firstname),localStorage.setItem("user_lastname",data.result.lastname),localStorage.setItem("user_title",data.result.title),$rootScope.user=data.result}),$state.go("user.Profile")})):$scope.error=!0})}}]),kuvenoApp.controller("SignUpCtrl",["$rootScope","$scope","$state","$wakanda","AuthSrv",function($scope,$rootScope,$state,$wakanda,AuthSrv){$scope.facebookRegister=function(){AuthSrv.facebookLogin()},$scope.unmatchedPassword=function(){return signupForm.password.value!=signupForm.retypePassword.value?!0:!1},$scope.emailRegister=function(){var newUser=$wakanda.$ds.User.signUpNewUser(signupForm.email.value,signupForm.password.value);$rootScope.user=newUser,$wakanda.$login(signupForm.email.value,signupForm.password.value).then(function(data){data.result?$wakanda.$currentUser().then(function(user){localStorage.setItem("user_id",user.result.ID),localStorage.setItem("user_email",user.result.userName),$state.go("user.ProfileUpdate")}):console.log(data)})}}]),kuvenoApp.controller("LangCtrl",["$scope","$translate",function($scope,$translate){$scope.lang=localStorage.getItem("lang"),$scope.changeLang=function(key){$scope.lang=key,localStorage.setItem("lang",key),$translate.use(key).then(function(){},function(){})}}]),kuvenoApp.controller("HomeCtrl",["$location","$rootScope","$scope","$state","$wakanda","AuthSrv",function($location,$rootScope,$scope,$state,$wakanda,AuthSrv){return AuthSrv.verify().then(function(data){var linkedinCode;data&&($rootScope.onBack?$rootScope.onBack=!1:$rootScope.$stateHistory.push("main.Home"),$location.$$absUrl.split("?code=").length>1&&(linkedinCode=$location.$$absUrl.split("?code=")[1].split("#/")[0],AuthSrv.linkedin(linkedinCode))),$scope.overdueTasks=Math.floor(100*Math.random()),$scope.openTasks=Math.floor(100*Math.random()),$scope.closedTasks=Math.floor(100*Math.random()),$scope.groups=[{title:"Group 1",meetings:[{title:"Meeting 1",date:"14/12/2014",status:"future",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 2",date:"14/12/2014",status:"future",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 3",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 4",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())}],isopen:!1},{title:"Group 2",meetings:[{title:"Meeting 1",date:"14/12/2014",status:"future",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 2",date:"14/12/2014",status:"future",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 3",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 4",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 5",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())}],isopen:!0},{title:"Group 3",meetings:[{title:"Meeting 1",date:"14/12/2014",status:"future",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 2",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 3",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())}],isopen:!1}],$scope.allFutureMeetings=[];for(var group in $scope.groups){var countFuture=0;for(var meeting in $scope.groups[group].meetings)$scope.groups[group].meetings[meeting].group=$scope.groups[group].title,"future"===$scope.groups[group].meetings[meeting].status&&($scope.allFutureMeetings.push($scope.groups[group].meetings[meeting]),countFuture++);$scope.groups[group].pastShown=3>countFuture?3-countFuture:1}})}]),kuvenoApp.controller("ChangePasswordCtrl",["$q","$rootScope","$scope","AuthSrv",function($q,$rootScope,$scope,AuthSrv){$scope.success=!1,$scope.error=!1,$rootScope.onBack?$rootScope.onBack=!1:$rootScope.$stateHistory.push("user.ChangePassword"),$scope.unmatchedPassword=function(){return changePasswordForm.newPassword.value!=changePasswordForm.retypeNewPassword.value?!0:!1},$scope.changePassword=function(){AuthSrv.checkPassword(changePasswordForm.currentPassword.value).then(function(data){data?AuthSrv.changePassword(changePasswordForm.newPassword.value).then(function(){$scope.success=!0,$scope.error=!1}):($scope.success=!1,$scope.error=!0)})}}]),kuvenoApp.controller("ProfileCtrl",["$rootScope","$scope","AuthSrv","UserSrv",function($rootScope,$scope,AuthSrv,UserSrv){AuthSrv.verify().then(function(data){return data?(UserSrv.getFacebookFollower($rootScope.user.facebook_id).then(function(data){for(var key in data)$rootScope.user[key]=data[key]}),$rootScope.onBack?$rootScope.onBack=!1:$rootScope.$stateHistory.push("user.Profile")):void 0})}]),kuvenoApp.controller("SendFeedbackCtrl",["$rootScope","$scope","AuthSrv","UserSrv",function($rootScope,$scope,AuthSrv,UserSrv){return AuthSrv.verify().then(function(data){return data?$rootScope.onBack?$rootScope.onBack=!1:$rootScope.$stateHistory.push("user.SendFeedback"):void 0}),$scope.sendFeedback=function(){UserSrv.sendFeedback($scope.title,$scope.content).then(function(data){data?$scope.success=!0:$scope.error=!0})}}]),kuvenoApp.controller("UpdateProfileCtrl",["$rootScope","$scope","$state","$wakanda","AuthSrv",function($scope,$rootScope,$state,$wakanda,AuthSrv){AuthSrv.verify().then(function(data){data&&($rootScope.onBack?$rootScope.onBack=!1:$rootScope.$stateHistory.push("user.ProfileUpdate"),$scope.updateProfile=function(){var user=$wakanda.$ds.User.$findOne(localStorage.getItem("user_id"));user.$promise.then(function(){user.title=updateProfileForm.title.value,user.firstname=updateProfileForm.firstName.value,user.lastname=updateProfileForm.lastName.value,user.email=updateProfileForm.email.value,user.$save(),$rootScope.user.title=user.title,$rootScope.user.firstname=user.firstname,$rootScope.user.lastname=user.lastname,$rootScope.user.email=user.email,localStorage.setItem("user_title",updateProfileForm.title.value),localStorage.setItem("user_firstname",updateProfileForm.firstName.value),localStorage.setItem("user_lastname",updateProfileForm.lastName.value),localStorage.setItem("user_email",updateProfileForm.email.value),$scope.success=!0})})})}]),kuvenoApp.directive("collapseNav",[function(){return{restrict:"A",link:function(scope,ele){var $a,$aRest,$lists,$listsRest,app;return $lists=ele.find("ul").parent("li"),$lists.append('<i class="fa fa-caret-right icon-has-ul"></i>'),$a=$lists.children("a"),$listsRest=ele.children("li").not($lists),$aRest=$listsRest.children("a"),app=$("#app"),$a.on("click",function(event){var $parent,$this;return app.hasClass("nav-min")?!1:($this=$(this),$parent=$this.parent("li"),$lists.not($parent).removeClass("open").find("ul").slideUp(),$parent.toggleClass("open").find("ul").slideToggle(),event.preventDefault())}),$aRest.on("click",function(){return $lists.removeClass("open").find("ul").slideUp()}),scope.$on("minNav:enabled",function(){return $lists.removeClass("open").find("ul").slideUp()})}}}]),kuvenoApp.directive("customBackground",function(){return{restrict:"A",controller:["$scope","$element","$location",function($scope,$element,$location){var addBg,path;return path=function(){return $location.path()},addBg=function(path){switch($element.removeClass("body-home body-special body-tasks body-lock"),path){case"/":return $element.addClass("body-home");case"/auth/sign_in":case"/auth/sign_up":return $element.addClass("body-special");case"/tasks":return $element.addClass("body-tasks")}},addBg($location.path()),$scope.$watch(path,function(newVal,oldVal){return newVal!==oldVal?addBg($location.path()):void 0})}]}}),kuvenoApp.directive("highlightActive",[function(){return{restrict:"A",controller:["$scope","$element","$attrs","$location",function($scope,$element,$attrs,$location){var highlightActive,links,path;return links=$element.find("a"),path=function(){return $location.path()},highlightActive=function(links,path){return path="#"+path,angular.forEach(links,function(link){var $li,$link,href;return $link=angular.element(link),$li=$link.parent("li"),href=$link.attr("href"),$li.hasClass("active")&&$li.removeClass("active"),0===path.indexOf(href)?$li.addClass("active"):void 0})},highlightActive(links,$location.path()),$scope.$watch(path,function(newVal,oldVal){return newVal!==oldVal?highlightActive(links,$location.path()):void 0})}]}}]),kuvenoApp.directive("imgHolder",[function(){return{restrict:"A",link:function(scope,ele){return Holder.run({images:ele[0]})}}}]),kuvenoApp.directive("slimScroll",[function(){return{restrict:"A",link:function(scope,ele){return ele.slimScroll({height:"100%"})}}}]),kuvenoApp.directive("toggleMinNav",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,ele){var $window,Timer,app,updateClass;return app=$("#app"),$window=$(window),ele.on("click",function(e){return app.hasClass("nav-min")?app.removeClass("nav-min"):(app.addClass("nav-min"),$rootScope.$broadcast("minNav:enabled")),e.preventDefault()}),Timer=void 0,updateClass=function(){var width;return width=$window.width(),768>width?app.removeClass("nav-min"):void 0},$window.resize(function(){var t;return clearTimeout(t),t=setTimeout(updateClass,300)})}}}]),kuvenoApp.directive("toggleMinNav",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,ele){var $window,Timer,app,updateClass;return app=$("#app"),$window=$(window),ele.on("click",function(e){return app.hasClass("nav-min")?app.removeClass("nav-min"):(app.addClass("nav-min"),$rootScope.$broadcast("minNav:enabled")),e.preventDefault()}),Timer=void 0,updateClass=function(){var width;return width=$window.width(),768>width?app.removeClass("nav-min"):void 0},$window.resize(function(){var t;return clearTimeout(t),t=setTimeout(updateClass,300)})}}}]),kuvenoApp.factory("AssistSrv",["$http","$q",function($http,$q){return{localeToCountry:function(locale){var defer=$q.defer();return $http.get("scripts/vendors/FacebookLocales.json").success(function(data){var item,_i,_len,_ref,_results;for(_ref=data.locales.locale,_results=[],_i=0,_len=_ref.length;_len>_i;_i++){if(item=_ref[_i],item.codes.code.standard.representation===locale){defer.resolve(item.englishName.split("(").length>1?item.englishName.split("(")[1].split(")")[0]:item.englishName);break}_results.push(void 0)}defer.resolve(_results)}).error(function(data){defer.reject(data)}),defer.promise},validateEmail:function(email){var re;return re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,re.test(email)}}}]),kuvenoApp.factory("AuthSrv",["$http","$q","$rootScope","$state","$wakanda","AssistSrv","Facebook",function($http,$q,$rootScope,$state,$wakanda,AssistSrv,Facebook){return{verify:function(){var defer=$q.defer();if(void 0===localStorage.user_id)defer.resolve(!1),$state.go("auth.SignIn");else{$rootScope.user=this.getUserData();var itv=setInterval(function(){$rootScope.wakandaInit&&(defer.resolve(!0),clearInterval(itv))},100)}return defer.promise},linkedin:function(){$http.post("https://www.linkedin.com/uas/oauth2/accessToken?grant_type=authorization_code&code=code&redirect_uri=https://thiepcuoiviet.net/freelance/fv0004/dist&client_id=7581d2bszc4sid&client_secret=oDYszogper1pau5d").success(function(data){console.log(data)}).error(function(data){$rootScope.error=data,$state.go("auth.SignIn")})},facebookLogin:function(){var getFacebookInformation,storeUser;storeUser=function(response){var defer=$q.defer();return $rootScope.user=response,AssistSrv.localeToCountry(response.locale).then(function(data){localStorage.setItem("user_facebook_id",response.id),localStorage.setItem("user_firstname",response.first_name),localStorage.setItem("user_lastname",response.last_name),localStorage.setItem("user_link",response.link),localStorage.setItem("user_locale",response.locale),localStorage.setItem("user_name",response.name),localStorage.setItem("user_timezone",response.timezone),localStorage.setItem("user_updated_time",response.updated_time),localStorage.setItem("user_verified",response.verified),localStorage.setItem("user_avatar","http://graph.facebook.com/"+response.id+"/picture"),localStorage.setItem("user_country",data),$rootScope.user.country=localStorage.getItem("user_country"),$rootScope.user.picture=localStorage.getItem("user_picture"),defer.resolve($rootScope.user)}),defer.promise},getFacebookInformation=function(){return Facebook.api("/me",function(response){$wakanda.$ds.User.signUpNewFBUser(response.id);$wakanda.$login(response.id,"FB-login").then(function(data){data.result?$wakanda.$currentUser().then(function(user){var user=$wakanda.$ds.User.$findOne(user.result.ID);user.$promise.then(function(){localStorage.setItem("user_id",user.ID),localStorage.setItem("user_email",user.email),localStorage.setItem("user_title",user.title),storeUser(response),$state.go("user.Profile")})}):console.log(data)})})},Facebook.getLoginStatus(function(response){$rootScope.loggedIn="connected"===response.status?!0:!1,$rootScope.loggedIn===!1?Facebook.login(function(response){$rootScope.loggedIn="connected"===response.status?!0:!1,$rootScope.loggedIn?getFacebookInformation():$rootScope.facebookLoginError=!0}):getFacebookInformation()})},checkPassword:function(password){var defer=$q.defer();return localStorage.getItem("user_facebook_id")?defer.resolve(!0):$wakanda.$loginByPassword(localStorage.getItem("user_email"),password).then(function(loginResult){defer.resolve(loginResult.result)}),defer.promise},changePassword:function(){var defer=$q.defer();return defer.resolve(!0),defer.promise},getUserData:function(){var user={id:localStorage.getItem("user_id"),email:localStorage.getItem("user_email"),title:localStorage.getItem("user_title"),facebook_id:localStorage.getItem("user_facebook_id"),firstname:localStorage.getItem("user_firstname"),lastname:localStorage.getItem("user_lastname"),link:localStorage.getItem("user_link"),locale:localStorage.getItem("user_locale"),name:localStorage.getItem("user_name"),timezone:localStorage.getItem("user_timezone"),updated_time:localStorage.getItem("user_updated_time"),verified:localStorage.getItem("user_verified"),avatar:localStorage.getItem("user_avatar"),country:localStorage.getItem("user_country")};return user.avatar||(user.avatar="/images/profile.png"),user}}}]),kuvenoApp.factory("UserSrv",["$http","$q","$rootScope","$state","Facebook",function($http,$q,$rootScope,$state,Facebook){var defer;return{sendFeedback:function(){return defer=$q.defer(),defer.resolve(!0),defer.promise},getFacebookFollower:function(){return defer=$q.defer(),Facebook.api("/uid",function(response){defer.resolve(response)}),defer.promise}}}]),window.kuvenoApp=angular.module("app",["ngRoute","ngAnimate","ngCookies","ui.bootstrap","pascalprecht.translate","ui.router","facebook","wakanda"]).run(["$rootScope","$state","$stateParams","$wakanda",function($rootScope,$state,$stateParams,$wakanda){var oninit;$rootScope.wakandaInit=!1,$rootScope.$stateHistory=[],$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.onBack=!1,$rootScope.back=function(){$rootScope.onBack=!0,$rootScope.$stateHistory.length>1&&($state.go($rootScope.$stateHistory[$rootScope.$stateHistory.length-2]),$rootScope.$stateHistory.pop())},$wakanda.init().then(oninit=function(ds){$rootScope.initialized="initialized",$rootScope.dataClasses=Object.keys(ds.getDataClasses()),$rootScope.wakandaInit=!0})}]).config(function(FacebookProvider){return FacebookProvider.init("1655840277976205")}).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $urlRouterProvider.otherwise("/main"),$stateProvider.state("auth",{url:"/auth",templateUrl:"views/auth.html"}).state("auth.SignUp",{url:"/sign_up",templateUrl:"views/auth/sign_up.html"}).state("auth.SignIn",{url:"/sign_in",templateUrl:"views/auth/sign_in.html"}).state("auth.SignOut",{url:"/sign_out",controller:function($state,$rootScope,$wakanda){localStorage.removeItem("user_id"),localStorage.removeItem("user_facebook_id"),localStorage.removeItem("user_firstname"),localStorage.removeItem("user_lastname"),localStorage.removeItem("user_link"),localStorage.removeItem("user_locale"),localStorage.removeItem("user_name"),localStorage.removeItem("user_timezone"),localStorage.removeItem("user_updated_time"),localStorage.removeItem("user_verified"),localStorage.removeItem("user_avatar"),localStorage.removeItem("user_country"),localStorage.removeItem("user_email"),localStorage.removeItem("user_title"),$rootScope.user={},$wakanda.$logout(),$state.go("auth.SignIn")}}).state("createMeetingNote",{url:"/create_meeting_note",templateUrl:"views/create_meeting_note.html"}).state("action",{url:"/action",templateUrl:"views/action.html"}).state("action.AgreeOnDate",{url:"/agree_on_date",templateUrl:"views/action/agree_on_date.html"}).state("action.CreateAgenda",{url:"/create_agenda",templateUrl:"views/action/create_agenda.html"}).state("action.ViewMeeting",{url:"/view_meeting/:meetingId",templateUrl:"views/action/view_meeting.html"}).state("action.ListAllMeeting",{url:"/list_all_meeting",templateUrl:"views/action/list_all_meeting.html"}).state("action.CreateEMeeting",{url:"/create_e_meeting",templateUrl:"views/action/create_e_meeting.html"}).state("action.ViewEMeeting",{url:"/view_e_meeting/:eMeetingId",templateUrl:"views/action/view_e_meeting.html"}).state("user",{url:"/user",templateUrl:"views/user.html"}).state("user.Profile",{url:"/profile",templateUrl:"views/user/profile.html"}).state("user.ProfileUpdate",{url:"/profile_update",templateUrl:"views/user/profile_update.html"}).state("user.ChangePassword",{url:"/change_password",templateUrl:"views/user/change_password.html"}).state("user.SendFeedback",{url:"/send_feedback",templateUrl:"views/user/send_feedback.html"}).state("user.Groups",{url:"/groups",templateUrl:"views/user/groups.html"}).state("user.MyTask",{url:"/my_task",templateUrl:"views/user/my_task.html"}).state("user.UpcommingMeeting",{url:"/upcomming_meeting",templateUrl:"views/user/upcomming_meeting.html"}).state("main",{url:"/main",templateUrl:"views/main.html"}).state("main.Home",{url:"/home",templateUrl:"views/main/home.html"})}]).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"/l10n/",suffix:".json"}),null===localStorage.getItem("lang")&&localStorage.setItem("lang","English"),$translateProvider.preferredLanguage(localStorage.getItem("lang"))}]),kuvenoApp.controller("AppCtrl",["$rootScope","$scope","$location",function($rootScope,$scope,$location){return $scope.isSpecificPage=function(){var path;return path=$location.path(),_.contains(["/auth/sign_up","/auth/sign_in"],path)},$rootScope.user=localStorage.getItem("user_id")?{id:localStorage.getItem("user_id"),first_name:localStorage.getItem("user_first_name"),last_name:localStorage.getItem("user_last_name"),link:localStorage.getItem("user_link"),locale:localStorage.getItem("user_locale"),name:localStorage.getItem("user_name"),timezone:localStorage.getItem("user_timezone"),updated_time:localStorage.getItem("user_updated_time"),verified:localStorage.getItem("user_verified"),avatar:localStorage.getItem("user_avatar"),country:localStorage.getItem("user_country")}:{},$scope.main={brand:"Kuveno"}}]).controller("NavCtrl",["$scope",function(){}]),kuvenoApp.controller("SignInCtrl",["$q","$rootScope","$scope","$state","$wakanda","AuthSrv",function($q,$rootScope,$scope,$state,$wakanda,AuthSrv){$q.defer();$scope.facebookLogin=function(){return AuthSrv.facebookLogin()},$scope.linkedinLogin=function(){return window.location.href="https://www.linkedin.com/uas/oauth2/authorization?response_type=code&client_id=7581d2bszc4sid&scope=r_emailaddress%20r_fullprofile%20r_basicprofile&state=KbyUmhTLMpYj7CD2di7JKP1PcqmLlkPt&redirect_uri=http://localhost:9000"},$scope.emailLogin=function(){$wakanda.$login(signinForm.email.value,signinForm.password.value).then(function(data){data.result?($scope.error=!1,$wakanda.$currentUser().then(function(user){localStorage.setItem("user_id",user.result.ID),localStorage.setItem("user_email",user.result.userName),$wakanda.$ds.User.$findOne(user.result.ID).$promise.then(function(data){localStorage.setItem("user_firstname",data.result.firstname),localStorage.setItem("user_lastname",data.result.lastname),localStorage.setItem("user_title",data.result.title),$rootScope.user=data.result}),$state.go("user.Profile")})):$scope.error=!0})}}]),kuvenoApp.controller("SignUpCtrl",["$rootScope","$scope","$state","$wakanda","AuthSrv",function($scope,$rootScope,$state,$wakanda,AuthSrv){$scope.facebookRegister=function(){AuthSrv.facebookLogin()},$scope.unmatchedPassword=function(){return signupForm.password.value!=signupForm.retypePassword.value?!0:!1},$scope.emailRegister=function(){var newUser=$wakanda.$ds.User.signUpNewUser(signupForm.email.value,signupForm.password.value);$rootScope.user=newUser,$wakanda.$login(signupForm.email.value,signupForm.password.value).then(function(data){data.result?$wakanda.$currentUser().then(function(user){localStorage.setItem("user_id",user.result.ID),localStorage.setItem("user_email",user.result.userName),$state.go("user.ProfileUpdate")}):console.log(data)})}}]),kuvenoApp.controller("LangCtrl",["$scope","$translate",function($scope,$translate){$scope.lang=localStorage.getItem("lang"),$scope.changeLang=function(key){$scope.lang=key,localStorage.setItem("lang",key),$translate.use(key).then(function(){},function(){})}}]),kuvenoApp.controller("HomeCtrl",["$location","$rootScope","$scope","$state","$wakanda","AuthSrv",function($location,$rootScope,$scope,$state,$wakanda,AuthSrv){return AuthSrv.verify().then(function(data){var linkedinCode;data&&($rootScope.onBack?$rootScope.onBack=!1:$rootScope.$stateHistory.push("main.Home"),$location.$$absUrl.split("?code=").length>1&&(linkedinCode=$location.$$absUrl.split("?code=")[1].split("#/")[0],AuthSrv.linkedin(linkedinCode))),$scope.overdueTasks=Math.floor(100*Math.random()),$scope.openTasks=Math.floor(100*Math.random()),$scope.closedTasks=Math.floor(100*Math.random()),$scope.groups=[{title:"Group 1",meetings:[{title:"Meeting 1",date:"14/12/2014",status:"future",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 2",date:"14/12/2014",status:"future",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 3",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 4",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())}],isopen:!1},{title:"Group 2",meetings:[{title:"Meeting 1",date:"14/12/2014",status:"future",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 2",date:"14/12/2014",status:"future",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 3",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 4",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 5",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())}],isopen:!0},{title:"Group 3",meetings:[{title:"Meeting 1",date:"14/12/2014",status:"future",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 2",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())},{title:"Meeting 3",date:"14/12/2014",status:"past",tasks:Math.floor(100*Math.random()),decisions:Math.floor(100*Math.random())}],isopen:!1}],$scope.allFutureMeetings=[];for(var group in $scope.groups){var countFuture=0;for(var meeting in $scope.groups[group].meetings)$scope.groups[group].meetings[meeting].group=$scope.groups[group].title,"future"===$scope.groups[group].meetings[meeting].status&&($scope.allFutureMeetings.push($scope.groups[group].meetings[meeting]),countFuture++);$scope.groups[group].pastShown=3>countFuture?3-countFuture:1}})}]),kuvenoApp.controller("ChangePasswordCtrl",["$q","$rootScope","$scope","AuthSrv",function($q,$rootScope,$scope,AuthSrv){$scope.success=!1,$scope.error=!1,$rootScope.onBack?$rootScope.onBack=!1:$rootScope.$stateHistory.push("user.ChangePassword"),$scope.unmatchedPassword=function(){return changePasswordForm.newPassword.value!=changePasswordForm.retypeNewPassword.value?!0:!1},$scope.changePassword=function(){AuthSrv.checkPassword(changePasswordForm.currentPassword.value).then(function(data){data?AuthSrv.changePassword(changePasswordForm.newPassword.value).then(function(){$scope.success=!0,$scope.error=!1}):($scope.success=!1,$scope.error=!0)})}}]),kuvenoApp.controller("ProfileCtrl",["$rootScope","$scope","AuthSrv","UserSrv",function($rootScope,$scope,AuthSrv,UserSrv){AuthSrv.verify().then(function(data){return data?(UserSrv.getFacebookFollower($rootScope.user.facebook_id).then(function(data){for(var key in data)$rootScope.user[key]=data[key]}),$rootScope.onBack?$rootScope.onBack=!1:$rootScope.$stateHistory.push("user.Profile")):void 0})}]),kuvenoApp.controller("SendFeedbackCtrl",["$rootScope","$scope","AuthSrv","UserSrv",function($rootScope,$scope,AuthSrv,UserSrv){return AuthSrv.verify().then(function(data){return data?$rootScope.onBack?$rootScope.onBack=!1:$rootScope.$stateHistory.push("user.SendFeedback"):void 0}),$scope.sendFeedback=function(){UserSrv.sendFeedback($scope.title,$scope.content).then(function(data){data?$scope.success=!0:$scope.error=!0})}}]),kuvenoApp.controller("UpdateProfileCtrl",["$rootScope","$scope","$state","$wakanda","AuthSrv",function($scope,$rootScope,$state,$wakanda,AuthSrv){AuthSrv.verify().then(function(data){data&&($rootScope.onBack?$rootScope.onBack=!1:$rootScope.$stateHistory.push("user.ProfileUpdate"),$scope.updateProfile=function(){var user=$wakanda.$ds.User.$findOne(localStorage.getItem("user_id"));user.$promise.then(function(){user.title=updateProfileForm.title.value,user.firstname=updateProfileForm.firstName.value,user.lastname=updateProfileForm.lastName.value,user.email=updateProfileForm.email.value,user.$save(),$rootScope.user.title=user.title,$rootScope.user.firstname=user.firstname,$rootScope.user.lastname=user.lastname,$rootScope.user.email=user.email,localStorage.setItem("user_title",updateProfileForm.title.value),localStorage.setItem("user_firstname",updateProfileForm.firstName.value),localStorage.setItem("user_lastname",updateProfileForm.lastName.value),localStorage.setItem("user_email",updateProfileForm.email.value),$scope.success=!0
})})})}]),kuvenoApp.directive("collapseNav",[function(){return{restrict:"A",link:function(scope,ele){var $a,$aRest,$lists,$listsRest,app;return $lists=ele.find("ul").parent("li"),$lists.append('<i class="fa fa-caret-right icon-has-ul"></i>'),$a=$lists.children("a"),$listsRest=ele.children("li").not($lists),$aRest=$listsRest.children("a"),app=$("#app"),$a.on("click",function(event){var $parent,$this;return app.hasClass("nav-min")?!1:($this=$(this),$parent=$this.parent("li"),$lists.not($parent).removeClass("open").find("ul").slideUp(),$parent.toggleClass("open").find("ul").slideToggle(),event.preventDefault())}),$aRest.on("click",function(){return $lists.removeClass("open").find("ul").slideUp()}),scope.$on("minNav:enabled",function(){return $lists.removeClass("open").find("ul").slideUp()})}}}]),kuvenoApp.directive("customBackground",function(){return{restrict:"A",controller:["$scope","$element","$location",function($scope,$element,$location){var addBg,path;return path=function(){return $location.path()},addBg=function(path){switch($element.removeClass("body-home body-special body-tasks body-lock"),path){case"/":return $element.addClass("body-home");case"/auth/sign_in":case"/auth/sign_up":return $element.addClass("body-special");case"/tasks":return $element.addClass("body-tasks")}},addBg($location.path()),$scope.$watch(path,function(newVal,oldVal){return newVal!==oldVal?addBg($location.path()):void 0})}]}}),kuvenoApp.directive("highlightActive",[function(){return{restrict:"A",controller:["$scope","$element","$attrs","$location",function($scope,$element,$attrs,$location){var highlightActive,links,path;return links=$element.find("a"),path=function(){return $location.path()},highlightActive=function(links,path){return path="#"+path,angular.forEach(links,function(link){var $li,$link,href;return $link=angular.element(link),$li=$link.parent("li"),href=$link.attr("href"),$li.hasClass("active")&&$li.removeClass("active"),0===path.indexOf(href)?$li.addClass("active"):void 0})},highlightActive(links,$location.path()),$scope.$watch(path,function(newVal,oldVal){return newVal!==oldVal?highlightActive(links,$location.path()):void 0})}]}}]),kuvenoApp.directive("imgHolder",[function(){return{restrict:"A",link:function(scope,ele){return Holder.run({images:ele[0]})}}}]),kuvenoApp.directive("slimScroll",[function(){return{restrict:"A",link:function(scope,ele){return ele.slimScroll({height:"100%"})}}}]),kuvenoApp.directive("toggleMinNav",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,ele){var $window,Timer,app,updateClass;return app=$("#app"),$window=$(window),ele.on("click",function(e){return app.hasClass("nav-min")?app.removeClass("nav-min"):(app.addClass("nav-min"),$rootScope.$broadcast("minNav:enabled")),e.preventDefault()}),Timer=void 0,updateClass=function(){var width;return width=$window.width(),768>width?app.removeClass("nav-min"):void 0},$window.resize(function(){var t;return clearTimeout(t),t=setTimeout(updateClass,300)})}}}]),kuvenoApp.directive("toggleMinNav",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,ele){var $window,Timer,app,updateClass;return app=$("#app"),$window=$(window),ele.on("click",function(e){return app.hasClass("nav-min")?app.removeClass("nav-min"):(app.addClass("nav-min"),$rootScope.$broadcast("minNav:enabled")),e.preventDefault()}),Timer=void 0,updateClass=function(){var width;return width=$window.width(),768>width?app.removeClass("nav-min"):void 0},$window.resize(function(){var t;return clearTimeout(t),t=setTimeout(updateClass,300)})}}}]),kuvenoApp.factory("AssistSrv",["$http","$q",function($http,$q){return{localeToCountry:function(locale){var defer=$q.defer();return $http.get("scripts/vendors/FacebookLocales.json").success(function(data){var item,_i,_len,_ref,_results;for(_ref=data.locales.locale,_results=[],_i=0,_len=_ref.length;_len>_i;_i++){if(item=_ref[_i],item.codes.code.standard.representation===locale){defer.resolve(item.englishName.split("(").length>1?item.englishName.split("(")[1].split(")")[0]:item.englishName);break}_results.push(void 0)}defer.resolve(_results)}).error(function(data){defer.reject(data)}),defer.promise},validateEmail:function(email){var re;return re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,re.test(email)}}}]),kuvenoApp.factory("AuthSrv",["$http","$q","$rootScope","$state","$wakanda","AssistSrv","Facebook",function($http,$q,$rootScope,$state,$wakanda,AssistSrv,Facebook){return{verify:function(){var defer=$q.defer();if(void 0===localStorage.user_id)defer.resolve(!1),$state.go("auth.SignIn");else{$rootScope.user=this.getUserData();var itv=setInterval(function(){$rootScope.wakandaInit&&(defer.resolve(!0),clearInterval(itv))},100)}return defer.promise},linkedin:function(){$http.post("https://www.linkedin.com/uas/oauth2/accessToken?grant_type=authorization_code&code=code&redirect_uri=https://thiepcuoiviet.net/freelance/fv0004/dist&client_id=7581d2bszc4sid&client_secret=oDYszogper1pau5d").success(function(data){console.log(data)}).error(function(data){$rootScope.error=data,$state.go("auth.SignIn")})},facebookLogin:function(){var getFacebookInformation,storeUser;storeUser=function(response){var defer=$q.defer();return $rootScope.user=response,AssistSrv.localeToCountry(response.locale).then(function(data){localStorage.setItem("user_facebook_id",response.id),localStorage.setItem("user_firstname",response.first_name),localStorage.setItem("user_lastname",response.last_name),localStorage.setItem("user_link",response.link),localStorage.setItem("user_locale",response.locale),localStorage.setItem("user_name",response.name),localStorage.setItem("user_timezone",response.timezone),localStorage.setItem("user_updated_time",response.updated_time),localStorage.setItem("user_verified",response.verified),localStorage.setItem("user_avatar","http://graph.facebook.com/"+response.id+"/picture"),localStorage.setItem("user_country",data),$rootScope.user.country=localStorage.getItem("user_country"),$rootScope.user.picture=localStorage.getItem("user_picture"),defer.resolve($rootScope.user)}),defer.promise},getFacebookInformation=function(){return Facebook.api("/me",function(response){$wakanda.$ds.User.signUpNewFBUser(response.id);$wakanda.$login(response.id,"FB-login").then(function(data){data.result?$wakanda.$currentUser().then(function(user){var user=$wakanda.$ds.User.$findOne(user.result.ID);user.$promise.then(function(){localStorage.setItem("user_id",user.ID),localStorage.setItem("user_email",user.email),localStorage.setItem("user_title",user.title),storeUser(response),$state.go("user.Profile")})}):console.log(data)})})},Facebook.getLoginStatus(function(response){$rootScope.loggedIn="connected"===response.status?!0:!1,$rootScope.loggedIn===!1?Facebook.login(function(response){$rootScope.loggedIn="connected"===response.status?!0:!1,$rootScope.loggedIn?getFacebookInformation():$rootScope.facebookLoginError=!0}):getFacebookInformation()})},checkPassword:function(password){var defer=$q.defer();return localStorage.getItem("user_facebook_id")?defer.resolve(!0):$wakanda.$loginByPassword(localStorage.getItem("user_email"),password).then(function(loginResult){defer.resolve(loginResult.result)}),defer.promise},changePassword:function(){var defer=$q.defer();return defer.resolve(!0),defer.promise},getUserData:function(){var user={id:localStorage.getItem("user_id"),email:localStorage.getItem("user_email"),title:localStorage.getItem("user_title"),facebook_id:localStorage.getItem("user_facebook_id"),firstname:localStorage.getItem("user_firstname"),lastname:localStorage.getItem("user_lastname"),link:localStorage.getItem("user_link"),locale:localStorage.getItem("user_locale"),name:localStorage.getItem("user_name"),timezone:localStorage.getItem("user_timezone"),updated_time:localStorage.getItem("user_updated_time"),verified:localStorage.getItem("user_verified"),avatar:localStorage.getItem("user_avatar"),country:localStorage.getItem("user_country")};return user.avatar||(user.avatar="/images/profile.png"),user}}}]),kuvenoApp.factory("UserSrv",["$http","$q","$rootScope","$state","Facebook",function($http,$q,$rootScope,$state,Facebook){var defer;return{sendFeedback:function(){return defer=$q.defer(),defer.resolve(!0),defer.promise},getFacebookFollower:function(){return defer=$q.defer(),Facebook.api("/uid",function(response){defer.resolve(response)}),defer.promise}}}]);